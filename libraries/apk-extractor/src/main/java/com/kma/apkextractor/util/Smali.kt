package com.kma.apkextractor.util

import com.kma.apkextractor.data.model.Method

private val COMMAND_KEYS = arrayOf("invoke-", "invoke-virtual", "invoke-direct")

val String.isCommand: Boolean
    get() = COMMAND_KEYS.any { key -> contains(other = key, ignoreCase = true) }

fun String.asMethod(): Method {
    val data = split(" ")
        .last()
        .split(";->")
    val klass = data[0].split("/")
    val className = klass.last()
    val packageName = (klass - className)
        .joinToString(separator = ".") { packageName -> packageName }
        .drop(n = 1)
    val method = data
        .getOrNull(index = 1)
        ?.split("(")
        ?.firstOrNull()
        .orEmpty()

    return Method(
        packageName = packageName,
        className = className,
        name = method
    )
}
